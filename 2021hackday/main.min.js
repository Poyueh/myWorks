var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),FristCommand=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){var e=this.facade.retrieveProxy(DataProxy.NAME);e.setInfo(t.getBody()),this.sendNotification("FRIST",t.getBody())},e.NAME="FristCommand",e}(puremvc.SimpleCommand);__reflect(FristCommand.prototype,"FristCommand");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function o(o){e.call(n,o,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?o(i):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&(this.facade=puremvc.Facade.getInstance(),this.registPureMVC(),this.facade.sendNotification(StartupCommand.NAME,StartupCommand.NAME))},e.prototype.registPureMVC=function(){this.facade.registerProxy(new DataProxy),this.facade.registerMediator(new NFTGashaponViewMediator(this)),this.facade.registerCommand(StartupCommand.NAME,StartupCommand),this.facade.registerCommand(FristCommand.NAME,FristCommand),this.facade.registerCommand(ButtonCommand.NAME,ButtonCommand)},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,o){function i(t){e.call(o,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(o))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var ButtonCommand=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){var e=this.facade.retrieveProxy(DataProxy.NAME);e.setInfo(t.getBody()),this.sendNotification("TAP",t.getBody())},e.NAME="ButtonCommand",e}(puremvc.SimpleCommand);__reflect(ButtonCommand.prototype,"ButtonCommand");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var StartupCommand=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){var e=this.facade.retrieveProxy(DataProxy.NAME);e.setInfo(t.getBody()),this.sendNotification("START",t.getBody())},e.NAME="StartupCommand",e}(puremvc.SimpleCommand);__reflect(StartupCommand.prototype,"StartupCommand");var NFTGashaponViewMediator=function(t){function e(n){var o=t.call(this,e.NAME,null)||this;return o.parentView=n,o.initView(),o}return __extends(e,t),e.prototype.initView=function(){this.nFTGashaponView=new NFTGashaponView,this.parentView.addChild(this.nFTGashaponView),this.nFTGashaponView.initView()},e.prototype.listNotificationInterests=function(){return["START","FRIST"]},e.prototype.handleNotification=function(t){var e=t.getName();switch(e){case"START":console.log("command: "+t.getBody()),this.facade.sendNotification(FristCommand.NAME,FristCommand.NAME);break;case"FRIST":console.log("command: "+t.getBody())}},e.NAME="NFTGashaponViewMediator",e}(puremvc.Mediator);__reflect(NFTGashaponViewMediator.prototype,"NFTGashaponViewMediator");var DataProxy=function(t){function e(){var n=t.call(this,e.NAME)||this;return n.count=0,n}return __extends(e,t),e.prototype.setInfo=function(t){this.testData=t,console.log("this.testData: "+this.testData)},e.prototype.getCount=function(){return this.count++,this.count},e.NAME="DataProxy",e}(puremvc.Proxy);__reflect(DataProxy.prototype,"DataProxy");var NFTGashaponView=function(t){function e(){var e=t.call(this)||this;return e.preHitNft="",e.bgmUrl="../resource/assets/bgm.mp3",e.spinUrl="../resource/assets/spin.mp3",e.tapUrl="../resource/assets/tap.mp3",e}return __extends(e,t),e.prototype.initView=function(){this.skinName="resource/eui_skins/NFTGashaponViewSkin.exml",this.leftUIGP.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leftUIEnabled,this),this.rightUIGP.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rightUIEnabled,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnIdle,this),this.touchGP.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gacha,this),this.enterGP.addEventListener(egret.TouchEvent.TOUCH_TAP,this.enterGacha,this),this.createDB()},e.prototype.createDB=function(){var t=RES.getRes("Game_ske_json"),e=RES.getRes("Game_tex_json"),n=RES.getRes("Game_tex_png"),o=dragonBones.EgretFactory.factory;o.parseDragonBonesData(t),o.parseTextureAtlasData(e,n),this.gachaDB=o.buildArmatureDisplay("Armature"),this.gashaponGP.addChild(this.gachaDB),this.nftImg=new eui.Image,this.nftImg.source="Award_01_png";var i=this.gachaDB.armature.getSlot("Award");i.display=this.nftImg,i.invalidUpdate(),this.nftImg.anchorOffsetX=this.nftImg.width/2,this.nftImg.anchorOffsetY=this.nftImg.height/2+25,this.gachaDB.animation.gotoAndPlayByFrame("Lobby",0,0),this.touchGP.visible=!1},e.prototype.enterGacha=function(){var t=this;this.enterGP.visible=!1,this.gachaDB.animation.gotoAndPlayByFrame("Idle_In",0,1),this.playAudio(this.bgmUrl,!0),this.gachaDB.once(dragonBones.EventObject.COMPLETE,function(){t.canGacha=!0,t.touchGP.visible=!0,t.gachaDB.animation.gotoAndPlayByFrame("Idle",0,0)},this)},e.prototype.gacha=function(){var t=this;this.backBtn.visible=!1,this.playAudio(this.spinUrl),this.touchGP.touchEnabled=!1,this.canGacha&&(this.canGacha=!1,this.gachaDB.once(dragonBones.EventObject.COMPLETE,function(){t.touchGP.touchEnabled=!0,t.canGacha=!0,t.backBtn.visible=!0,t.gachaDB.animation.gotoAndPlayByFrame("Win_Idle",0,0)},this),this.gachaDB.animation.gotoAndPlayByFrame("Win",0,1),this.randomNft())},e.prototype.randomNft=function(){var t=Math.floor(10*Math.random())+1,e=10>t?"Award_0"+t+"_png":"Award_"+t+"_png";e==this.preHitNft?this.randomNft():(this.preHitNft=e,this.nftImg.source=e)},e.prototype.returnIdle=function(){this.playAudio(this.tapUrl),this.backBtn.visible=!1,this.gachaDB.animation.gotoAndPlayByFrame("Idle",0,0)},e.prototype.leftUIEnabled=function(){this.playAudio(this.tapUrl),this.leftOnImg.visible?(this.leftOnImg.visible=!1,this.leftOffImg.visible=!0):(this.leftOnImg.visible=!0,this.leftOffImg.visible=!1)},e.prototype.rightUIEnabled=function(){this.playAudio(this.tapUrl),this.rightOnImg.visible?(this.rightOnImg.visible=!1,this.rightOffImg.visible=!0):(this.rightOnImg.visible=!0,this.rightOffImg.visible=!1)},e.prototype.playAudio=function(t,e){void 0===e&&(e=!1);var n=document.createElement("audio");e&&(n.loop=!0),n.src=t,n.play()},e}(eui.Component);__reflect(NFTGashaponView.prototype,"NFTGashaponView");